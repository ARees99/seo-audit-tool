<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SEO Audit Tool</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 2rem; max-width: 900px; margin: auto; }
    h1, h2, h3 { margin-top: 2rem; }
    .section { margin-top: 1.5rem; padding: 1rem; background: #fff; border-radius: 6px; box-shadow: 0 0 5px rgba(0,0,0,0.05); }
    .success { color: green; } .warn { color: orange; } .error { color: red; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.9rem; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #f0f0f0; text-align: left; }
    .thumb { width: 50px; height: auto; object-fit: contain; }
    .button-bar { margin-top: 2rem; display: flex; gap: 1rem; flex-wrap: wrap; }
    button { flex: 1; padding: 0.75rem; font-size: 1rem; }
    input, label { margin-top: 1rem; display: block; width: 100%; }
  </style>
</head>
<body>
  <h1>SEO Audit Tool</h1>

  <input id="urlInput" type="text" placeholder="https://example.com" />
  <label><input type="checkbox" id="checkStructure" /> Check structure and accessibility</label>
  <input type="text" id="keywordInput" placeholder="Target keyword (optional)" />
  <button onclick="runAudit()">Run SEO Audit</button>
  <button id="showSpeedBtn" class="hidden" onclick="fetchPageSpeed()">Show PageSpeed Performance</button>

  <div class="button-bar hidden" id="exportButtons">
    <button onclick="exportPDF('styled')">Download Styled PDF</button>
    <button onclick="exportPDF('minimal')">Download Minimal PDF</button>
    <button onclick="exportCSV()">Download CSV</button>
  </div>

  <div id="results" class="section"></div>

  <script>
    const apiKey = "AIzaSyDYnYVicNNc07jd6KJCpHCS8kNzOn42GXY";
    let lastURL = "", lastReport = "";

    async function runAudit() {
      const url = document.getElementById("urlInput").value.trim();
      const keyword = document.getElementById("keywordInput").value.trim().toLowerCase();
      const checkStructure = document.getElementById("checkStructure").checked;
      const results = document.getElementById("results");
      const speedBtn = document.getElementById("showSpeedBtn");
      const exportBtns = document.getElementById("exportButtons");

      lastURL = url;
      results.innerHTML = `<p>Running audit...</p>`;
      speedBtn.classList.add("hidden");
      exportBtns.classList.add("hidden");

      try {
        const proxyUrl = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`;
        const res = await fetch(proxyUrl);
        if (!res.ok) throw new Error("Failed to fetch site");

        const html = await res.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");

        const title = doc.querySelector("title")?.textContent || "No title";
        const description = doc.querySelector("meta[name='description']")?.content || "No meta description";
        const h1 = doc.querySelector("h1")?.textContent || "None";

        let report = `Title: ${title}
Meta Description: ${description}
H1: ${h1}
`;

        results.innerHTML = `
          <h2>SEO Audit Results</h2>
          <p><strong>Title:</strong> ${title}</p>
          <p><strong>Meta Description:</strong> ${description}</p>
          <p><strong>H1:</strong> ${h1}</p>
        `;

        const allImgs = [...doc.querySelectorAll("img")];
        const missingAlts = allImgs.filter(img => !img.alt).length;
        const badNames = allImgs.filter(img => {
          const name = img.src.split("/").pop() || "";
          return !/^[a-z0-9\-]+(\.jpg|\.png|\.jpeg|\.webp|\.gif)$/i.test(name) || /(image|img|abc|xyz|123|logo)/i.test(name);
        }).length;

        results.innerHTML += `
          <h3>Image Audit</h3>
          <p>Images found: ${allImgs.length}</p>
          <p class="${missingAlts ? 'warn' : 'success'}">Missing alt tags: ${missingAlts}</p>
          <p class="${badNames ? 'warn' : 'success'}">Non-descriptive filenames: ${badNames}</p>
        `;

        const wordCount = doc.body.innerText.split(/\s+/).filter(w => w.length > 3).length;
        const tagCount = doc.body.querySelectorAll("*").length;
        const density = Math.round((wordCount / tagCount) * 100) / 100;
        results.innerHTML += `<h3>Content</h3><p><strong>Words:</strong> ${wordCount}, <strong>Density:</strong> ${density} words/tag</p>`;

        if (keyword) {
          const matches = [];
          if (title.toLowerCase().includes(keyword)) matches.push("✓ In Title");
          if (description.toLowerCase().includes(keyword)) matches.push("✓ In Meta Description");
          if (h1.toLowerCase().includes(keyword)) matches.push("✓ In H1");
          if (allImgs.some(img => img.src.toLowerCase().includes(keyword))) matches.push("✓ In Image Filename");

          results.innerHTML += `<h3>Keyword Check: "${keyword}"</h3><ul>${matches.length ? matches.map(m => `<li>${m}</li>`).join('') : '<li class="warn">Not Found</li>'}</ul>`;
        }

        lastReport = results.innerText;
        exportBtns.classList.remove("hidden");
        speedBtn.classList.remove("hidden");

      } catch (err) {
        results.innerHTML = `<p class="error">Audit Error: ${err.message}</p>`;
      }
    }

    function exportPDF(type) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      if (type === "styled") {
        doc.setFontSize(16);
        doc.text("SEO Audit Report", 10, 20);
        doc.setFontSize(12);
        const lines = lastReport.split("
");
        let y = 30;
        lines.forEach(line => { doc.text(line, 10, y); y += 8; });
      } else {
        doc.text(lastReport, 10, 10);
      }
      doc.save(`seo-report-${type}.pdf`);
    }

    function exportCSV() {
      const csvContent = `data:text/csv;charset=utf-8,${lastReport.replace(/
/g, "
")}`;
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      saveAs(blob, `seo-report.csv`);
    }

    async function fetchPageSpeed() {
      const results = document.getElementById("results");
      results.innerHTML += `<p>Fetching PageSpeed data... (this may take up to 20 seconds)</p>`;
      const response = await fetch(`https://www.googleapis.com/pagespeedonline/v5/runPagespeed?url=${encodeURIComponent(lastURL)}&strategy=desktop&key=${apiKey}`);
      const data = await response.json();
      if (data.lighthouseResult) {
        const perf = data.lighthouseResult.categories.performance.score * 100;
        const fcp = data.lighthouseResult.audits['first-contentful-paint']?.displayValue || "N/A";
        results.innerHTML += `<h3>PageSpeed Insights</h3><p><strong>Performance:</strong> ${perf}/100</p><p><strong>FCP:</strong> ${fcp}</p>`;
      } else {
        results.innerHTML += `<p class="error">PageSpeed fetch failed.</p>`;
      }
    }
  </script>
</body>
</html>